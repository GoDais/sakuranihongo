    const vocabQuizDataEasy = [
      { jp: "学生", en: "student", roma: "gakusei" },
      { jp: "先生", en: "teacher", roma: "sensei" },
      { jp: "学校", en: "school", roma: "gakkou" },
      { jp: "友達", en: "friend", roma: "tomodachi" },
      { jp: "家", en: "house", roma: "ie" },
      { jp: "父", en: "father", roma: "chichi" },
      { jp: "母", en: "mother", roma: "haha" },
      { jp: "兄", en: "older brother", roma: "ani" },
      { jp: "姉", en: "older sister", roma: "ane" },
      { jp: "弟", en: "younger brother", roma: "otouto" },
      { jp: "妹", en: "younger sister", roma: "imouto" },
      { jp: "犬", en: "dog", roma: "inu" },
      { jp: "猫", en: "cat", roma: "neko" },
      { jp: "本", en: "book", roma: "hon" },
      { jp: "新聞", en: "newspaper", roma: "shinbun" },
      { jp: "手紙", en: "letter", roma: "tegami" },
      { jp: "電話", en: "telephone", roma: "denwa" },
      { jp: "水", en: "water", roma: "mizu" },
      { jp: "お茶", en: "tea", roma: "ocha" },
      { jp: "ご飯", en: "rice", roma: "gohan" },
      { jp: "パン", en: "bread", roma: "pan" },
      { jp: "卵", en: "egg", roma: "tamago" },
      { jp: "魚", en: "fish", roma: "sakana" },
      { jp: "肉", en: "meat", roma: "niku" },
      { jp: "野菜", en: "vegetable", roma: "yasai" },
      { jp: "果物", en: "fruit", roma: "kudamono" },
      { jp: "車", en: "car", roma: "kuruma" },
      { jp: "自転車", en: "bicycle", roma: "jitensha" },
      { jp: "電車", en: "train", roma: "densha" },
      { jp: "駅", en: "station", roma: "eki" },
      { jp: "道", en: "road", roma: "michi" },
      { jp: "町", en: "town", roma: "machi" },
      { jp: "店", en: "shop", roma: "mise" },
      { jp: "病院", en: "hospital", roma: "byouin" },
      { jp: "医者", en: "doctor", roma: "isha" },
      { jp: "会社", en: "company", roma: "kaisha" },
      { jp: "仕事", en: "work", roma: "shigoto" },
      { jp: "勉強", en: "study", roma: "benkyou" },
      { jp: "教室", en: "classroom", roma: "kyoushitsu" },
      { jp: "窓", en: "window", roma: "mado" },
      { jp: "机", en: "desk", roma: "tsukue" },
      { jp: "椅子", en: "chair", roma: "isu" },
      { jp: "時計", en: "clock", roma: "tokei" },
      { jp: "ペン", en: "pen", roma: "pen" },
      { jp: "ノート", en: "notebook", roma: "nooto" },
      { jp: "紙", en: "paper", roma: "kami" },
      { jp: "バッグ", en: "bag", roma: "baggu" },
      { jp: "靴", en: "shoes", roma: "kutsu" },
      { jp: "服", en: "clothes", roma: "fuku" },
      { jp: "帽子", en: "hat", roma: "boushi" },
      { jp: "傘", en: "umbrella", roma: "kasa" },
      { jp: "財布", en: "wallet", roma: "saifu" },
      { jp: "鍵", en: "key", roma: "kagi" },
      { jp: "部屋", en: "room", roma: "heya" },
      { jp: "トイレ", en: "toilet", roma: "toire" },
      { jp: "お風呂", en: "bath", roma: "ofuro" },
      { jp: "台所", en: "kitchen", roma: "daidokoro" },
      { jp: "ドア", en: "door", roma: "doa" },
      { jp: "床", en: "floor", roma: "yuka" },
      { jp: "天井", en: "ceiling", roma: "tenjou" },
      { jp: "壁", en: "wall", roma: "kabe" },
      { jp: "電気", en: "electricity", roma: "denki" },
      { jp: "パソコン", en: "computer", roma: "pasokon" },
      { jp: "テレビ", en: "television", roma: "terebi" },
      { jp: "ラジオ", en: "radio", roma: "rajio" },
      { jp: "カメラ", en: "camera", roma: "kamera" },
      { jp: "映画", en: "movie", roma: "eiga" },
      { jp: "音楽", en: "music", roma: "ongaku" },
      { jp: "歌", en: "song", roma: "uta" },
      { jp: "絵", en: "picture", roma: "e" },
      { jp: "写真", en: "photo", roma: "shashin" },
      { jp: "本棚", en: "bookshelf", roma: "hondana" },
      { jp: "箱", en: "box", roma: "hako" },
      { jp: "冷蔵庫", en: "refrigerator", roma: "reizouko" },
      { jp: "電子レンジ", en: "microwave", roma: "denshi renji" },
      { jp: "扇風機", en: "fan", roma: "senpuuki" },
      { jp: "エアコン", en: "air conditioner", roma: "eakon" },
      { jp: "ベッド", en: "bed", roma: "beddo" },
      { jp: "枕", en: "pillow", roma: "makura" },
      { jp: "毛布", en: "blanket", roma: "moufu" },
      { jp: "郵便局", en: "post office", roma: "yuubinkyoku" },
      { jp: "銀行", en: "bank", roma: "ginkou" },
      { jp: "公園", en: "park", roma: "kouen" },
      { jp: "図書館", en: "library", roma: "toshokan" },
      { jp: "スーパー", en: "supermarket", roma: "suupaa" },
      { jp: "レストラン", en: "restaurant", roma: "resutoran" },
      { jp: "バス", en: "bus", roma: "basu" },
      { jp: "飛行機", en: "airplane", roma: "hikouki" },
      { jp: "船", en: "ship", roma: "fune" },
      { jp: "信号", en: "traffic light", roma: "shingou" },
      { jp: "橋", en: "bridge", roma: "hashi" },
      { jp: "交差点", en: "crossroad", roma: "kousaten" }
    ];
    const vocabQuizDataMedium = [
      { jp: "銀行", en: "bank", roma: "ginkou" },
      { jp: "病院", en: "hospital", roma: "byouin" },
      { jp: "駅", en: "station", roma: "eki" },
      { jp: "郵便局", en: "post office", roma: "yuubinkyoku" },
      { jp: "勉強", en: "study", roma: "benkyou" },
      { jp: "映画", en: "movie", roma: "eiga" },
      { jp: "旅行", en: "travel", roma: "ryokou" },
      { jp: "写真", en: "photo", roma: "shashin" },
      { jp: "友達", en: "friend", roma: "tomodachi" },
      { jp: "天気", en: "weather", roma: "tenki" }
    ];
    const vocabQuizDataHard = [
      { jp: "環境", en: "environment", roma: "kankyou" },
      { jp: "経済", en: "economy", roma: "keizai" },
      { jp: "技術", en: "technology", roma: "gijutsu" },
      { jp: "伝統", en: "tradition", roma: "dentou" },
      { jp: "資源", en: "resource", roma: "shigen" },
      { jp: "制度", en: "system", roma: "seido" },
      { jp: "責任", en: "responsibility", roma: "sekinin" },
      { jp: "発展", en: "development", roma: "hatten" },
      { jp: "構造", en: "structure", roma: "kouzou" },
      { jp: "状況", en: "situation", roma: "joukyou" }
    ];

    // 既存のひらがな・カタカナ⇔ローマ字クイズ
    const quizData = [
      { hira: "あ", kata: "ア", roma: "a" }, { hira: "い", kata: "イ", roma: "i" }, { hira: "う", kata: "ウ", roma: "u" },
      { hira: "え", kata: "エ", roma: "e" }, { hira: "お", kata: "オ", roma: "o" }, { hira: "か", kata: "カ", roma: "ka" },
      { hira: "き", kata: "キ", roma: "ki" }, { hira: "く", kata: "ク", roma: "ku" }, { hira: "け", kata: "ケ", roma: "ke" },
      { hira: "こ", kata: "コ", roma: "ko" }, { hira: "さ", kata: "サ", roma: "sa" }, { hira: "し", kata: "シ", roma: "shi" },
      { hira: "す", kata: "ス", roma: "su" }, { hira: "せ", kata: "セ", roma: "se" }, { hira: "そ", kata: "ソ", roma: "so" },
      { hira: "た", kata: "タ", roma: "ta" }, { hira: "ち", kata: "チ", roma: "chi" }, { hira: "つ", kata: "ツ", roma: "tsu" },
      { hira: "て", kata: "テ", roma: "te" }, { hira: "と", kata: "ト", roma: "to" }, { hira: "な", kata: "ナ", roma: "na" },
      { hira: "に", kata: "ニ", roma: "ni" }, { hira: "ぬ", kata: "ヌ", roma: "nu" }, { hira: "ね", kata: "ネ", roma: "ne" },
      { hira: "の", kata: "ノ", roma: "no" }, { hira: "は", kata: "ハ", roma: "ha" }, { hira: "ひ", kata: "ヒ", roma: "hi" },
      { hira: "ふ", kata: "フ", roma: "fu" }, { hira: "へ", kata: "ヘ", roma: "he" }, { hira: "ほ", kata: "ホ", roma: "ho" },
      { hira: "ま", kata: "マ", roma: "ma" }, { hira: "み", kata: "ミ", roma: "mi" }, { hira: "む", kata: "ム", roma: "mu" },
      { hira: "め", kata: "メ", roma: "me" }, { hira: "も", kata: "モ", roma: "mo" }, { hira: "や", kata: "ヤ", roma: "ya" },
      { hira: "ゆ", kata: "ユ", roma: "yu" }, { hira: "よ", kata: "ヨ", roma: "yo" }, { hira: "ら", kata: "ラ", roma: "ra" },
      { hira: "り", kata: "リ", roma: "ri" }, { hira: "る", kata: "ル", roma: "ru" }, { hira: "れ", kata: "レ", roma: "re" },
      { hira: "ろ", kata: "ロ", roma: "ro" }, { hira: "わ", kata: "ワ", roma: "wa" }, { hira: "を", kata: "ヲ", roma: "wo" },
      { hira: "ん", kata: "ン", roma: "n" }
    ];

    let currentQuestion, currentMode, timer, timeLeft = 10;
    let score = 0;
    let mistakes = 0;
    let gameActive = false;
    let currentVocabList = []; // 難易度別Japanese→English用

    function startQuiz(mode) {
      // Japanese→English 難易度別
      if (mode.startsWith('jpToEn')) {
        if (mode === 'jpToEn-easy') currentVocabList = vocabQuizDataEasy;
        if (mode === 'jpToEn-medium') currentVocabList = vocabQuizDataMedium;
        if (mode === 'jpToEn-hard') currentVocabList = vocabQuizDataHard;
        currentMode = mode;
        score = 0;
        mistakes = 0;
        gameActive = true;
        document.getElementById("gameOver").classList.add("hidden");
        updateScore();
        updateMistakes();
        getRandomQuestion();
        return;
      }
      // 既存のモード
      currentMode = mode;
      score = 0;
      mistakes = 0;
      gameActive = true;
      document.getElementById("gameOver").classList.add("hidden");
      updateScore();
      updateMistakes();
      getRandomQuestion();
    }

    function updateScore() {
      const scoreEl = document.getElementById("scoreDisplay");
      scoreEl.textContent = `Score: ${score}`;
      scoreEl.classList.remove("score-animate");
      void scoreEl.offsetWidth;
      scoreEl.classList.add("score-animate");
    }

    function updateMistakes() {
      const mistakeEl = document.getElementById("mistakeDisplay");
      if (!gameActive) {
        mistakeEl.textContent = "";
      } else {
        mistakeEl.textContent = `Miss : ${mistakes} / 5`;
      }
    }

    function getRandomQuestion() {
      if (!gameActive) return;
      clearInterval(timer);
      timeLeft = 10;
      updateTimer();

      // Japanese→English 難易度別
      if (currentMode && currentMode.startsWith('jpToEn')) {
        currentQuestion = currentVocabList[Math.floor(Math.random() * currentVocabList.length)];
        const questionText = currentQuestion.jp;
        const correctAnswer = currentQuestion.en;
        const choices = new Set();
        choices.add(correctAnswer);
        while (choices.size < 4) {
          const rand = currentVocabList[Math.floor(Math.random() * currentVocabList.length)];
          choices.add(rand.en);
        }
        const shuffled = Array.from(choices).sort(() => Math.random() - 0.5);

        document.getElementById("question").textContent = questionText;
        const feedback = document.getElementById("feedback");
        feedback.textContent = "";
        feedback.classList.remove("correct", "incorrect");

        const choicesContainer = document.getElementById("choices");
        choicesContainer.innerHTML = "";
        shuffled.forEach(choice => {
          const btn = document.createElement("button");
          btn.textContent = choice;
          btn.className = "text-xl sm:text-2xl md:text-3xl px-4 sm:px-6 md:px-8 py-3 sm:py-4 bg-blue-500 hover:bg-blue-600 text-white rounded-lg shadow-md transition duration-300 w-full sm:w-auto";
          btn.onclick = () => checkAnswer(choice, correctAnswer);
          choicesContainer.appendChild(btn);
        });

        timer = setInterval(() => {
          timeLeft--;
          updateTimer();
          if (timeLeft <= 0) {
            clearInterval(timer);
            processMistake("Time Over！");
          }
        }, 1000);

        return;
      }

      // 既存モード（ひらがな⇔ローマ字）
      currentQuestion = quizData[Math.floor(Math.random() * quizData.length)];
      let questionText, correctAnswer;

      if (currentMode === 'hiraToRoma') {
        questionText = currentQuestion.hira;
        correctAnswer = currentQuestion.roma;
      } else if (currentMode === 'romaToHira') {
        questionText = currentQuestion.roma;
        correctAnswer = currentQuestion.hira;
      } else if (currentMode === 'kataToRoma') {
        questionText = currentQuestion.kata;
        correctAnswer = currentQuestion.roma;
      } else if (currentMode === 'romaToKata') {
        questionText = currentQuestion.roma;
        correctAnswer = currentQuestion.kata;
      } else {
        questionText = "Choose Quiz from Menu！";
        correctAnswer = "";
      }

      document.getElementById("question").textContent = questionText;
      const feedback = document.getElementById("feedback");
      feedback.textContent = "";
      feedback.classList.remove("correct", "incorrect");

      const choices = new Set();
      choices.add(correctAnswer);
      while (choices.size < 4) {
        const rand = quizData[Math.floor(Math.random() * quizData.length)];
        if (currentMode === 'hiraToRoma' || currentMode === 'kataToRoma')
          choices.add(rand.roma);
        else if (currentMode === 'romaToHira')
          choices.add(rand.hira);
        else if (currentMode === 'romaToKata')
          choices.add(rand.kata);
      }

      const shuffled = Array.from(choices).sort(() => Math.random() - 0.5);
      const choicesContainer = document.getElementById("choices");
      choicesContainer.innerHTML = "";
      shuffled.forEach(choice => {
        const btn = document.createElement("button");
        btn.textContent = choice;
        btn.className = "text-xl sm:text-2xl md:text-3xl px-4 sm:px-6 md:px-8 py-3 sm:py-4 bg-blue-500 hover:bg-blue-600 text-white rounded-lg shadow-md transition duration-300 w-full sm:w-auto";
        btn.onclick = () => checkAnswer(choice, correctAnswer);
        choicesContainer.appendChild(btn);
      });

      timer = setInterval(() => {
        timeLeft--;
        updateTimer();
        if (timeLeft <= 0) {
          clearInterval(timer);
          processMistake("Time Over！");
        }
      }, 1000);
    }

    function updateTimer() {
      document.getElementById("timer").textContent = `Time Left: ${timeLeft}`;
    }

    function checkAnswer(selected, correct) {
      if (!gameActive) return;
      clearInterval(timer);
      const feedback = document.getElementById("feedback");
      feedback.classList.remove("correct", "incorrect");
      void feedback.offsetWidth;

      if (selected === correct) {
        score++;
        updateScore();
        feedback.textContent = "Correct！";
        feedback.classList.add("correct");
        setTimeout(() => {
          if (gameActive) getRandomQuestion();
        }, 1000);
      } else {
        processMistake(`Miss！Correct Answer is 「${correct}」`);
      }
    }

    function processMistake(message) {
      mistakes++;
      updateMistakes();
      const feedback = document.getElementById("feedback");
      feedback.textContent = message;
      feedback.classList.remove("correct");
      feedback.classList.add("incorrect");
      if (mistakes >= 5) {
        endGame();
      } else {
        setTimeout(() => {
          if (gameActive) getRandomQuestion();
        }, 1500);
      }
    }

    function endGame() {
      gameActive = false;
      clearInterval(timer);
      document.getElementById("gameOver").classList.remove("hidden");
      document.getElementById("finalScore").textContent = `Your Score is ${score}！`;
      document.getElementById("question").textContent = "";
      document.getElementById("choices").innerHTML = "";
      document.getElementById("timer").textContent = "";
      document.getElementById("feedback").textContent = "";
      updateMistakes();
    }

    function restartQuiz() {
      document.getElementById("gameOver").classList.add("hidden");
      document.getElementById("scoreDisplay").textContent = "Score: 0";
      document.getElementById("mistakeDisplay").textContent = "";
      document.getElementById("question").textContent = "Choose Quiz from Menu！";
      document.getElementById("choices").innerHTML = "";
      document.getElementById("timer").textContent = "Time Left: --";
      document.getElementById("feedback").textContent = "";
      // モードを選び直しにしたい場合は何もしない（モード継続なら下行を入れる）
      // startQuiz(currentMode);
    }

    function toggleMobileMenu() {
      const menu = document.getElementById("mobileMenu");
      menu.classList.toggle("hidden");
    }

    function toggleSubMenu(id) {
      const menu = document.getElementById(id);
      const icon = document.getElementById(id + "Icon");
      menu.classList.toggle('hidden');
      if (icon) icon.classList.toggle('rotate-180');
    }